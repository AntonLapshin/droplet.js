!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.uit=t.uit||{})}(this,function(t){"use strict";function e(t,e){var n=this,i=void 0,o=t.split(".");"data"!==o[0]?(i=y(this,[].concat(u(o))),m(i,e)):(o.shift(),this.on("set",function(t){n.olddata&&(i=y(n.olddata,[].concat(u(o))),b(i,e)),i=y(t,[].concat(u(o))),m(i,e)}))}function n(){var t=this;this.elAll&&0!==this.elAll.length&&Array.prototype.filter.call(this.elAll,function(t){return h(t,"["+B.DATA_BIND_ATTRIBUTE+"]")}).forEach(function(e){e.getAttribute(B.DATA_BIND_ATTRIBUTE).split(",").forEach(function(n){var i=n.split(":"),o=i[0].trim(),r=i[1].trim();g[o]&&g[o].call(t,e,r,n)})})}function i(t,e){return j(t,e,"<div "+B.DATA_BLOCK_NAME_ATTRIBUTE+'="'+e+'"></div>')}var o=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},r=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),a=function t(e,n,i){null===e&&(e=Function.prototype);var o=Object.getOwnPropertyDescriptor(e,n);if(void 0===o){var r=Object.getPrototypeOf(e);return null===r?void 0:t(r,n,i)}if("value"in o)return o.value;var a=o.get;if(void 0!==a)return a.call(i)},c=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},l=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},u=function(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)},s=0,f=function(){function t(){o(this,t),this.handlers={}}return r(t,[{key:"on",value:function(t,e){this.handlers.hasOwnProperty(t)||(this.handlers[t]=[]);var n=s++;return this.handlers[t].push({token:n,handler:e}),n}},{key:"fire",value:function(t,e,n){return!!this.handlers.hasOwnProperty(t)&&(this.handlers[t].forEach(function(t){return t.handler(e,n)}),!0)}},{key:"off",value:function(t){var e=this;for(var n in this.handlers)!function(n){var i=e.handlers[n];i.forEach(function(e,n){if(e.token===t)return i.splice(n,1),!0})}(n);return!1}},{key:"once",value:function(t,e){var n=this,i=this.on(t,function(t){e(t),n.off(i)})}}]),t}(),d=function(t,e){return(t?t+"+":"")+e},h=function(t,e){return(t.matches||t.matchesSelector||t.msMatchesSelector||t.mozMatchesSelector||t.webkitMatchesSelector||t.oMatchesSelector).call(t,e)},p=function(t,e){for(;(t=t.parentElement)&&!h(t,e););return t},A={},T={},v=function(t){return new Promise(function(e){var n=t.getAttribute(B.DATA_BLOCK_NAME_ATTRIBUTE),i=A[n];if(!i.view)throw"View of "+n+" block is undefined";var o=p(t,"["+B.DATA_BLOCK_NAME_ATTRIBUTE+"]"),r=o?o.getAttribute(B.DATA_BLOCK_PATH_ATTRIBUTE):"root",a=t.getAttribute(B.DATA_BLOCK_CALL_ATTRIBUTE),c=d(r,n);if(o){var l=T[r];a===B.CALL_BY_INDEX?(l.children[n]||(l.children[n]=[]),c+="["+l.children[n].length+"]"):"string"==typeof a&&(l.children[n]||(l.children[n]={}),c+="["+a+"]")}t.classList.add("_"+n),t.setAttribute(B.DATA_BLOCK_READY_ATTRIBUTE,!0),t.setAttribute(B.DATA_BLOCK_PATH_ATTRIBUTE,c),t.innerHTML=i.view;var u=new O(n,c,t,i.logic);if(T[c]=u,o&&r){var s=T[r];a===B.CALL_BY_INDEX?s.children[n].push(u):a?s.children[n][a]=u:s.children[n]=u,u.parent=s}_(t).then(function(){u.load(),e(u)})})},_=function(t){var e=t.querySelectorAll("["+B.DATA_BLOCK_NAME_ATTRIBUTE+"]:not(["+B.DATA_BLOCK_READY_ATTRIBUTE+"]")||[],n=Array.prototype.map.call(e,function(t){return v(t)});return Promise.all(n)},y=function t(e,n){return 0===n.length?e:(e=e[n[0]],n.shift(),t(e,n))},m=function(t,e){t.on?(t.on(e),e(t())):e(t)},b=function(t,e){t.off&&t.off(e)},E=function(t){return null==t?t:t.on?t():t},g={src:function(t,n){e.call(this,n,function(e){t.setAttribute("src",E(e))})},text:function(t,n){e.call(this,n,function(e){t.textContent=E(e)})},class:function(t,n,i){var o=i.split(":")[2].trim();e.call(this,n,function(e){t.classList.toggle(o,E(e))})},attr:function(t,n,i){var o=i.split(":")[2].trim();e.call(this,n,function(e){t.setAttribute(o,E(e))})},href:function(t,n){e.call(this,n,function(e){t.setAttribute("href",E(e))})},val:function(t,n){e.call(this,n,function(e){t.value=E(e)})},html:function(t,n){e.call(this,n,function(e){t.innerHTML=E(e)})},visible:function(t,n){e.call(this,n,function(e){t.style.display=E(e)?"":"none"})},invisible:function(t,n){e.call(this,n,function(e){t.style.display=E(e)?"none":""})},enable:function(t,n){e.call(this,n,function(e){t.classList.toggle("disabled",!E(e))})},disable:function(t,n){e.call(this,n,function(e){t.classList.toggle("disabled",E(e))})},click:function(t,e){var n=this;t.addEventListener("click",function(){return n[e].call(n,t),!1})},prop:function(t,e){this[e]=t}},B={DATA_BLOCK_NAME_ATTRIBUTE:"data-block-name",DATA_BLOCK_READY_ATTRIBUTE:"data-block-ready",DATA_BLOCK_PATH_ATTRIBUTE:"data-block-path",DATA_BLOCK_CALL_ATTRIBUTE:"data-block-call",DATA_BIND_ATTRIBUTE:"data-bind",CALL_BY_INDEX:"byIndex",BASE_URL:"./blocks/"},O=function(t){function e(t,i,r,a){o(this,e);var c=l(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return c.name=t,c.path=i,c.el=r,c.elAll=r.querySelectorAll("*:not(["+B.DATA_BLOCK_NAME_ATTRIBUTE+"])"),c.children={},a(c),n.call(c),c}return c(e,t),r(e,[{key:"set",value:function(t){return this.olddata=this.data,this.data=t,this.fire("set",t,this.olddata),this}},{key:"load",value:function(){return this.fire("load"),this}},{key:"show",value:function(){return this.el.style.display="",this.fire("show"),this}},{key:"hide",value:function(){return this.el.style.display="none",this.fire("hide"),this}},{key:"test",value:function(){return this.el.style.display="",this.fire("test"),this}}]),e}(f),L=[{load:function(t,e){var n=new Image;n.onload=function(){e(n)},n.src=t},ext:/\b(png|jpg|gif)\b/},{load:function(t,e){var n=document.createElement("link");n.rel="stylesheet",n.href=t,document.head.appendChild(n),e(n)},ext:/\b(css)\b/},{load:function(t,e){var n=document.createElement("script");n.type="text/javascript",n.onload=function(){e(n)},n.src=t,document.getElementsByTagName("head")[0].appendChild(n)},ext:/\b(js)\b/},{load:function(t,e){var n=new XMLHttpRequest;n.open("GET",t,!0),n.onreadystatechange=function(){4===n.readyState&&n.responseText.length>0&&e(n.responseText)},n.send()},ext:/\b(html)\b/}],w=function(t){var e=t.split(".").pop(),n=L.find(function(t){return t.ext.test(e)});return new Promise(function(i){if(!n)throw"Loader for <"+e+"> files has not been implemented";n.cache||(n.cache={}),n.load(t,function(e){n.cache[t]=e,i(e)}),setTimeout(function(){n.cache[t]||(n.cache[t]=!0,i(!0))},3e3)})},C=function(t){function e(t){o(this,e);var n=l(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return n.data=t,n}return c(e,t),r(e,[{key:"update",value:function(t){return this.olddata=this.data,this.data=t,this.fire()}},{key:"fire",value:function(){return a(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"fire",this).call(this,"update",this.data,this.olddata)}},{key:"on",value:function(t){return a(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"on",this).call(this,"update",t)}}]),e}(f),j=function(t,e,n){if(t instanceof Element!=!0)throw"el is not an Element instance";return I(e).then(function(){var e=document.createElement("div");e.innerHTML=n;var i=e.firstChild;return t.appendChild(i),_(t)})},D=function(t,e){var n=B.BASE_URL+t+"/",i=e.map(function(t){return-1===t.indexOf(".")?I(t):w(n+t)});return Promise.all(i)},I=function(t){return A[t]?A[t].promise:new Promise(function(e){k.on(t+".load",function(t){e(t)}),D(t,["logic.js"])})},k=new f;t.event=k,t.define=function(t,e,n){var i={name:t,deps:null};A[t]=i,i.promise=new Promise(function(o){D(t,["view.html","style.css"].concat(u(e))).then(function(e){i.view=e[0],i.deps=e,i.logic=function(t){n.call(t,t,i.deps)},k.fire(t+".load",i),o(i)})})},t.append=i,t.run=function(t){var e=window.location.search,n=e.length>0?e.substring(1):null;return Promise.all([i(t,n),w("https://cdnjs.cloudflare.com/ajax/libs/jsoneditor/5.7.2/jsoneditor.min.js"),w("https://cdnjs.cloudflare.com/ajax/libs/jsoneditor/5.7.2/jsoneditor.min.css")]).then(function(t){var e=t[0][0],n=document.createElement("div");n.innerHTML='\n      <div class="debug">\n        <div id="jsoneditor"></div>\n      </div>      \n    ',document.getElementsByTagName("body")[0].appendChild(n.firstChild),document.getElementsByTagName("body")[0].appendChild(n.firstChild);var i=document.getElementById("jsoneditor"),o=new JSONEditor(i,{mode:"tree",onChange:function(t,e,n){var i;return function(){var o=this,r=arguments,a=n&&!i;clearTimeout(i),i=setTimeout(function(){i=null,n||t.apply(o,r)},e),a&&t.apply(o,r)}}(function(){var t=o.get();e.set(t)},300)});return e.once("set",function(t){o.set(t)}),e.test(),e})},t.Observable=function(t){var e=new C(t),n=function t(n){return void 0===n?e.data:(e.update(n),t)};return n.on=function(t){return e.on(t)},n.off=function(t){return e.off(t)},n},Object.defineProperty(t,"__esModule",{value:!0})});
