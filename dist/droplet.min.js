!function(t,n){"function"==typeof define&&define.amd?define(["jquery"],n):"object"==typeof module&&module.exports?module.exports=n(require("jquery")):t.Droplet=n(t.$)}(this,function(t){function n(t,n){return"{0}{1}".f(t?t+"+":"",n)}function e(e){var i,o,a=t.Deferred(),s=e.attr("data-droplet"),u=b[s],c=e.parents("[data-droplet]").eq(0),l=c.attr("data-name"),f=e.attr("data-call"),d=n(l,s);l&&(i=w[l],"byIndex"===f?(i.children[s]||(i.children[s]=[]),o=i.children[s].length,d+="[{0}]".f(o)):""!==f&&(i.children[s]||(i.children[s]={}),d+="[{0}]".f(f))),e.addClass(s).attr("data-ready",!0).attr("data-name",d).hide().html(u.view);var h=new q(s,d,u.constructor,e);if(w[d]=h,l){var i=w[l];void 0!==o?i.children[s].push(h):f?i.children[s][f]=h:i.children[s]=h,h.parent=i}return r(e).then(function(){h.load(),a.resolve(h)}),a}function r(n){n=n||t("body");var r=n.find("[data-droplet]").not("[data-ready]");if(0===r.length){var i=t.Deferred();return i.resolve(),i}var o=[];return r.each(function(){var n=t(this);o.push(e(n))}),t.when.apply(this,o)}function i(n,e,i){t(n);return f(e).always(function(){var e=t(n);return e.append(i),r(e)})}function o(n,e){if(!e||0===e.length){var r=t.Deferred();return r.resolve(),r}var i=j.baseUrl.f(n),o=[];return t.each(e,function(t,n){var e=i+n;e.endsWith(".jpg")||e.endsWith("png")?o.push(a(e)):e.endsWith(".html")?o.push(s(e)):e.endsWith(".css")?o.push(u(e)):e.endsWith(".js")?o.push(l(e)):o.push(f(e.split("/").pop()))}),t.when.apply(this,o)}function a(n){var e=t.Deferred();if(O[n])return e.resolve(O[n]),e;var r=t("<img />").on("load",function(){O[n]=r,e.resolve(r)}).attr("src",n);return setTimeout(function(){O[n]=!0,e.resolve(r)},j.timeout),e}function s(n){var e=t.Deferred();return x[n]||window.production?void e.resolve(x[n]):(t("<div />").load(n,function(t,r,i){if("success"!==r)throw"Cannot load the view: {0}".f(n);x[n]=t,e.resolve(t)}),e)}function u(n){var e=t.Deferred();return D[n]||window.production?(e.resolve(D[n]),e):(t('<link rel="stylesheet" type="text/css" href="{0}" />'.f(n)).appendTo("head"),D[n]=!0,e.resolve(),e)}function c(n){var e=t.Deferred(),r=document.createElement("script");return r.type="text/javascript",r.readyState?r.onreadystatechange=function(){"loaded"!=r.readyState&&"complete"!=r.readyState||(r.onreadystatechange=null,e.resolve())}:r.onload=function(){e.resolve()},r.src=n,document.getElementsByTagName("head")[0].appendChild(r),e}function l(n){var e=t.Deferred();return $[n]?(e.resolve($[n]),e):(window.require?require([n.substr(0,n.length-3)],function(t){$[n]=t,e.resolve(t)}):c(n).then(function(){$[n]=!0,e.resolve()}),e)}function f(n){if(b[n]){var e=t.Deferred();return e.resolve(b[n]),e}var r={name:n,deps:null};b[n]=r;var i=t.Deferred();P.on("{0}.load".f(n),function(t){i.resolve(t)});var a=t.Deferred();return o(n,["view.html","style.css","logic.js"]).then(function(t){r.view=t,a.resolve()}),t.when.apply(this,[i,a])}function d(n,e){var r,i=this;if(Array.isArray(n))return void t.each(n,function(t,n){d.call(i,n,e)});var o=n.split(".");"data"!==o[0]?(r=h(i,o),p(r,e)):(o.shift(),i.on("set",function(t){i.data&&(r=h(i.data,o),v(r,e)),r=h(t,o),p(r,e)}))}function h(n,e){var r=n;return t.each(e,function(t,n){r=r[n]}),r}function p(t,n){t.on?(t.on(n),n(t())):n(t)}function v(t,n){t.off&&t.off(n)}function y(t){return null==t?t:t.on?t():t}String.prototype.f=function(){var t=arguments;return this.replace(/{(\d+)}/g,function(n,e){return"undefined"!=typeof t[e]?t[e]:n})};var w={},m=[],g={},b={},x={},D={},O={},$={},j={baseUrl:"./droplets/{0}/",timeout:2e3},q=function(){function n(){this.events={}}function e(t,n,e,r){this.dropletName=t,this.name=n,this.$all=r.find("*").not("[data-droplet]"),this.$droplet=r,this.children={},e(this)}function r(r,i,o,a){n.call(this),e.call(this,r,i,o,a);var s=this;return t.each(m,function(t,n){n.call(s)}),this}return n.prototype={on:function(t,n){this.events.hasOwnProperty(t)||(this.events[t]=[]),this.events[t].push(n)},fire:function(n,e){this.events.hasOwnProperty(n)&&t.each(this.events[n],function(t,n){n(e)})}},e.prototype={set:function(t){return this.fire("set",t),this.data=t,this},load:function(){return this.fire("load"),this},show:function(){return this.$droplet.show(),this.fire("show"),this},hide:function(){return this.$droplet.hide(),this.fire("hide"),this},test:function(){return this.$droplet.hide(),this.fire("test"),this}},r.prototype=t.extend({},n.prototype,e.prototype),r.prototype.constructor=r,r}();q.prototype.bind=d;var E={title:function(t,n){t.attr({"data-toggle":"tooltip","data-placement":"bottom"}),window.setTimeout(function(){t.tooltip()},0),d.call(this,n,function(n){t.attr("title",y(n))})},src:function(t,n){d.call(this,n,function(n){t.attr("src",y(n))})},text:function(t,n){d.call(this,n,function(n){t.text(y(n))})},val:function(t,n){d.call(this,n,function(n){t.val(y(n))})},html:function(t,n){d.call(this,n,function(n){t.html(y(n))})},visible:function(t,n){d.call(this,n,function(n){t[y(n)?"show":"hide"]()})},invisible:function(t,n){d.call(this,n,function(n){t[y(n)?"hide":"show"]()})},enable:function(t,n){d.call(this,n,function(n){t.toggleClass("disabled",!y(n))})},click:function(t,n){var e=this;t.click(function(){e[n].call(e,t)})},place:function(t,n){t.attr("data-placement",n)},prop:function(t,n){this["$"+n]=t}},P=window.Droplet={Instance:q,define:function(){var t=arguments[0],n=arguments[1],e=arguments[2],r=b[t];return o(t,n).then(function(){r.deps=arguments,r.constructor=function(t){e.apply(t,r.deps)},P.fire("{0}.load".f(t),r)}),this},append:function(t,n){return i(n,t,'<div data-droplet="{0}"></div>'.f(t))},appendList:function(n,e,r,o,a){for(var s="",u='<li data-droplet="{0}" data-call="byIndex"></li>'.f(r),c=0;c<o.length;c++)s+=u;return i(e,r,s).always(function(){t.each(o,function(t,e){n.children[r][t].set(e),!a&&n.children[r][t].show()})})},run:function(t){var n=window.location.search,e=n.length>0?n.substring(1):null;return this.append(e,t).always(function(t){t.test()})},loadDroplet:f,loadImage:a,on:function(t,n){return g.hasOwnProperty(t)||(g[t]=[]),g[t].push(n),this},off:function(t,n){if(!g.hasOwnProperty(t))return this;var e=g[t].indexOf(n);return g[t].splice(e,1),this},fire:function(n,e){return g.hasOwnProperty(n)?(t.each(g[n],function(t,n){n(e)}),this):this},addExtension:function(t){return m.push(t),this},setOptions:function(n){return n.baseUrl&&(n.baseUrl=n.baseUrl+"/{0}/"),j=t.extend(j,n),this}};return P.observable=function(){function t(t,n){var e=r[t];e||(e=[],r[t]=e),e.push(n)}function n(t,n){var e=r[t];if(e){var i=e.indexOf(n);e.splice(i,1)}}function e(t,n,e){var i=r[t];i&&i.forEach(function(t){t(n,e)})}var r=[],i=0;return function(r){var o=r,a=i++,s=function(t){if(void 0===t)return o;var n=o;o=t,e(a,t,n)};return s.on=function(n){t(a,n)},s.off=function(t){n(a,t)},s}}(),P.addExtension(function(){var n=this;n.$all.filter("[data-bind]").each(function(){var e=t(this),r=e.data("bind").split(",");t.each(r,function(t,r){var i=r.split(":"),o=i[0].trim(),a=i[1].trim();E[o]&&E[o].call(n,e,a,r)})})}),P});